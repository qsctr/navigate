'use strict';
const uniformCostSearch = (start, goal) => bestFirstSearch(start, goal, ({ parentScore, distance }) => parentScore + distance);
const greedySearch = (start, goal) => bestFirstSearch(start, goal, ({ node }) => distanceBetween(node, goal));
const aStarSearch = (start, goal) => bestFirstSearch(start, goal, ({ node, parentScore, distance }) => parentScore + distance + distanceBetween(node, goal));
function bestFirstSearch(start, goal, scoreFunc) {
    const expanded = [];
    const scores = new Map([[start.id, scoreFunc({
                node: start,
                parentScore: 0,
                distance: 0
            })]]);
    const parents = new Map();
    const fringe = new PriorityQueue({
        comparator: (a, b) => scores.get(a.id) - scores.get(b.id),
        initialValues: [start]
    });
    while (fringe.length > 0) {
        const current = fringe.dequeue();
        if (expanded.includes(current)) {
            continue;
        }
        expanded.push(current);
        const currentScore = scores.get(current.id);
        if (current === goal) {
            const path = [goal];
            let parent = goal;
            while (parent !== start) {
                parent = parents.get(parent.id);
                path.unshift(parent);
            }
            return { expanded, path, fringe };
        }
        for (const { distance, child } of current.connections) {
            if (expanded.includes(child)) {
                continue;
            }
            const oldChildScore = scores.get(child.id);
            const newChildScore = scoreFunc({
                node: child,
                parentScore: currentScore,
                distance
            });
            if (oldChildScore === undefined || newChildScore < oldChildScore) {
                scores.set(child.id, newChildScore);
                parents.set(child.id, current);
                fringe.queue(child);
            }
        }
    }
    return { expanded };
}
function distanceBetween(a, b) {
    return Math.sqrt(Math.pow(a.lat - b.lat, 2) + Math.pow(a.lng - b.lng, 2));
}
function overpassToGraphNodes({ elements }) {
    const graphNodes = [];
    for (const { nodes, geometry, tags: { junction } } of elements) {
        let prevGraphNode;
        let firstGraphNode;
        nodes.forEach((nodeId, i) => {
            let graphNode = graphNodes.find(graphNode => graphNode.id === nodeId);
            if (graphNode === undefined) {
                graphNode = {
                    id: nodeId,
                    lat: geometry[i].lat,
                    lng: geometry[i].lon,
                    connections: []
                };
                graphNodes.push(graphNode);
            }
            if (i === 0) {
                firstGraphNode = graphNode;
            }
            else {
                connect(graphNode, prevGraphNode);
            }
            if (i === nodes.length - 1 && junction === 'roundabout') {
                connect(graphNode, firstGraphNode);
            }
            prevGraphNode = graphNode;
        });
    }
    return graphNodes;
    function connect(a, b) {
        const distance = distanceBetween(a, b);
        a.connections.push({ distance, child: b });
        b.connections.push({ distance, child: a });
    }
}
'use strict';
onerror = alert;
(() => {
    const qs = document.querySelector.bind(document);
    const qsa = document.querySelectorAll.bind(document);
    const introScreen = qs('#intro-screen');
    const queryButton = qs('#query-button');
    const areaTooBig = qs('#area-too-big-warning');
    const queryingScreen = qs('#querying-screen');
    const chooseScreen = qs('#choose-screen');
    const nodesCreatedElem = qs('#nodes-created');
    const startNodeIdElem = qs('#start-node-id');
    const goalNodeIdElem = qs('#goal-node-id');
    const searchButton = qs('#search-button');
    const resultsScreen = qs('#results-screen');
    const pathResult = qs('#path-result');
    const expandedResult = qs('#expanded-result');
    const fringeResult = qs('#fringe-result');
    const backButton = qs('#back-button');
    const sidebarItems = Array.prototype.slice.call(qsa('#sidebar > *'));
    const colors = {
        default: '#3388ff',
        start: 'red',
        goal: 'green',
        expanded: 'darkblue',
        path: '#009688',
        fringe: 'orange'
    };
    let map;
    let startNode = null;
    let goalNode = null;
    let searchFunction;
    queryButton.addEventListener('click', query);
    searchButton.addEventListener('click', search);
    const radioToFunction = {
        'uniform-cost-radio': uniformCostSearch,
        'greedy-radio': greedySearch,
        'a-star-radio': aStarSearch
    };
    for (const id in radioToFunction) {
        document.querySelector('#' + id).addEventListener('click', () => {
            searchFunction = radioToFunction[id];
            checkSearchButton();
        });
    }
    backButton.addEventListener('click', chooseAgain);
    const nodeIdToCircle = new Map();
    let pathLine = null;
    navigator.geolocation.getCurrentPosition(pos => init(pos.coords.latitude, pos.coords.longitude), () => init(25.116035, 121.529946) // fallback to TAS
    );
    function init(lat, lng) {
        map = L.map('map', {
            center: [lat, lng],
            zoom: 17,
            worldCopyJump: true
        });
        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 21,
            maxNativeZoom: 19
        }).addTo(map);
        map.on('zoom', () => {
            if (map.getZoom() < 13) {
                queryButton.disabled = true;
                showElem(areaTooBig);
            }
            else {
                queryButton.disabled = false;
                hideElem(areaTooBig);
            }
        });
        showOnly(introScreen);
    }
    function query() {
        showOnly(queryingScreen);
        const bounds = map.getBounds();
        const overpassQL = `[out:json];way[highway](${bounds.getSouth()},${bounds.getWest()},${bounds.getNorth()},${bounds.getEast()});out geom;`;
        fetch('https://overpass-api.de/api/interpreter?data=' + overpassQL)
            .then(res => res.json())
            .then(createNodes);
    }
    function createNodes(data) {
        const nodes = overpassToGraphNodes(data);
        for (const node of nodes) {
            const circle = L.circle(node, {
                radius: 6,
                stroke: false,
                fillOpacity: 0.7,
                color: colors.default
            }).bindPopup(() => {
                const elem = document.createElement('div');
                const id = document.createElement('div');
                id.textContent = node.id.toString();
                elem.appendChild(id);
                const startLink = document.createElement('a');
                startLink.href = '#';
                startLink.textContent = 'Set as start';
                startLink.addEventListener('click', () => {
                    if (node === goalNode) {
                        goalNode = null;
                        goalNodeIdElem.textContent = '';
                        nodeIdToCircle.get(node.id).setStyle({
                            color: colors.default
                        });
                    }
                    if (startNode !== null) {
                        nodeIdToCircle.get(startNode.id).setStyle({
                            color: colors.default
                        });
                    }
                    startNode = node;
                    startNodeIdElem.textContent = startNode.id.toString();
                    checkSearchButton();
                    circle.closePopup();
                    circle.setStyle({
                        color: colors.start
                    });
                });
                elem.appendChild(startLink);
                elem.appendChild(document.createElement('br'));
                const goalLink = document.createElement('a');
                goalLink.href = '#';
                goalLink.textContent = 'Set as goal';
                goalLink.addEventListener('click', () => {
                    if (node === startNode) {
                        startNode = null;
                        startNodeIdElem.textContent = '';
                        nodeIdToCircle.get(node.id).setStyle({
                            color: colors.default
                        });
                    }
                    if (goalNode !== null) {
                        nodeIdToCircle.get(goalNode.id).setStyle({
                            color: colors.default
                        });
                    }
                    goalNode = node;
                    goalNodeIdElem.textContent = goalNode.id.toString();
                    checkSearchButton();
                    circle.closePopup();
                    circle.setStyle({
                        color: colors.goal
                    });
                });
                elem.appendChild(goalLink);
                return elem;
            }).addTo(map);
            nodeIdToCircle.set(node.id, circle);
        }
        nodesCreatedElem.textContent = nodes.length.toString();
        showOnly(chooseScreen);
    }
    function search() {
        const { expanded, path, fringe } = searchFunction(startNode, goalNode);
        expandedResult.textContent = expanded.length.toString();
        for (const exp of expanded) {
            nodeIdToCircle.get(exp.id).setStyle({
                color: colors.expanded
            });
        }
        if (path === undefined) {
            pathResult.textContent = 'Path not found.';
        }
        else {
            pathResult.textContent = `Path found with ${path.length} nodes.`;
            pathLine = L.polyline(path, {
                weight: 8,
                color: colors.path
            }).addTo(map);
        }
        if (fringe === undefined) {
            fringeResult.textContent = 'No';
        }
        else {
            fringeResult.textContent = fringe.length.toString();
            while (fringe.length > 0) {
                nodeIdToCircle.get(fringe.dequeue().id).setStyle({
                    color: colors.fringe
                });
            }
        }
        showOnly(resultsScreen);
    }
    function chooseAgain() {
        for (const circle of nodeIdToCircle.values()) {
            circle.setStyle({
                color: colors.default
            });
            if (pathLine !== null) {
                pathLine.remove();
                pathLine = null;
            }
        }
        showOnly(chooseScreen);
    }
    function checkSearchButton() {
        searchButton.disabled = !(startNode && goalNode && searchFunction);
    }
    function showOnly(elem) {
        for (const item of sidebarItems) {
            hideElem(item);
        }
        showElem(elem);
    }
    function showElem(elem) {
        elem.style.display = 'block';
    }
    function hideElem(elem) {
        elem.style.display = 'none';
    }
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjLXRzL3NlYXJjaC50cyIsIi4uL3NyYy10cy91aS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7QUE2Q2IsTUFBTSxpQkFBaUIsR0FBbUIsQ0FBQyxLQUFLLEVBQUUsSUFBSSxLQUNsRCxlQUFlLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxLQUFLLFdBQVcsR0FBRyxRQUFRLENBQUMsQ0FBQztBQUV4RixNQUFNLFlBQVksR0FBbUIsQ0FBQyxLQUFLLEVBQUUsSUFBSSxLQUM3QyxlQUFlLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLEtBQUssZUFBZSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0FBRTVFLE1BQU0sV0FBVyxHQUFtQixDQUFDLEtBQUssRUFBRSxJQUFJLEtBQzVDLGVBQWUsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxLQUN6RCxXQUFXLEdBQUcsUUFBUSxHQUFHLGVBQWUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUU5RCx5QkFBeUIsS0FBZ0IsRUFBRSxJQUFlLEVBQzFELFNBQTBCO0lBQ3RCLE1BQU0sUUFBUSxHQUFnQixFQUFFLENBQUM7SUFDakMsTUFBTSxNQUFNLEdBQUcsSUFBSSxHQUFHLENBQVksQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsU0FBUyxDQUFDO2dCQUNwRCxJQUFJLEVBQUUsS0FBSztnQkFDWCxXQUFXLEVBQUUsQ0FBQztnQkFDZCxRQUFRLEVBQUUsQ0FBQzthQUNkLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNOLE1BQU0sT0FBTyxHQUFHLElBQUksR0FBRyxFQUFpQixDQUFDO0lBQ3pDLE1BQU0sTUFB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QUFJLFFBQVEsSUFBSSxjQUFjLENBQUMsQ0FBQztJQUN2RSxDQUFDO0lBRUQsa0JBQWtCLElBQWlCO1FBQy9CLEdBQUcsQ0FBQyxDQUFDLE1BQU0sSUFBSSxJQUFJLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDOUIsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25CLENBQUM7UUFDRCxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkIsQ0FBQztJQUVELGtCQUFrQixJQUFpQjtRQUMvQixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7SUFDakMsQ0FBQztJQUVELGtCQUFrQixJQUFpQjtRQUMvQixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7SUFDaEMsQ0FBQztBQUVMLENBQUMsQ0FBQyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG50eXBlIElkID0gbnVtYmVyO1xyXG50eXBlIFNjb3JlID0gbnVtYmVyO1xyXG50eXBlIERpc3RhbmNlID0gbnVtYmVyO1xyXG5cclxuaW50ZXJmYWNlIEdyYXBoTm9kZSB7XHJcbiAgICByZWFkb25seSBsYXQ6IG51bWJlcjtcclxuICAgIHJlYWRvbmx5IGxuZzogbnVtYmVyO1xyXG4gICAgcmVhZG9ubHkgaWQ6IElkO1xyXG4gICAgcmVhZG9ubHkgY29ubmVjdGlvbnM6IENvbm5lY3Rpb25bXTtcclxufVxyXG5cclxuaW50ZXJmYWNlIENvbm5lY3Rpb24geyAvLyBcIkFkamFjZW5jeVwiIGlzIHRvbyBoYXJkIHRvIHNwZWxsXHJcbiAgICByZWFkb25seSBkaXN0YW5jZTogRGlzdGFuY2U7XHJcbiAgICByZWFkb25seSBjaGlsZDogR3JhcGhOb2RlO1xyXG59XHJcblxyXG50eXBlIFNjb3JpbmdGdW5jdGlvbiA9IChpbmZvOiB7XHJcbiAgICBub2RlOiBHcmFwaE5vZGU7XHJcbiAgICBwYXJlbnRTY29yZTogU2NvcmU7XHJcbiAgICBkaXN0YW5jZTogRGlzdGFuY2U7XHJcbn0pID0+IFNjb3JlO1xyXG5cclxuaW50ZXJmYWNlIE92ZXJwYXNzSlNPTiB7XHJcbiAgICBlbGVtZW50czoge1xyXG4gICAgICAgIG5vZGVzOiBudW1iZXJbXTtcclxuICAgICAgICBnZW9tZXRyeToge1xyXG4gICAgICAgICAgICBsYXQ6IG51bWJlcjtcclxuICAgICAgICAgICAgbG9uOiBudW1iZXI7XHJcbiAgICAgICAgfVtdO1xyXG4gICAgICAgIHRhZ3M6IHtcclxuICAgICAgICAgICAganVuY3Rpb246IHN0cmluZ1xyXG4gICAgICAgIH07XHJcbiAgICB9W107XHJcbn1cclxuXHJcbnR5cGUgU2VhcmNoRnVuY3Rpb24gPSAoc3RhcnQ6IEdyYXBoTm9kZSwgZ29hbDogR3JhcGhOb2RlKSA9PiBTZWFyY2hSZXN1bHQ7XHJcblxyXG50eXBlIFNlYXJjaFJlc3VsdCA9IHtcclxuICAgIGV4cGFuZGVkOiBHcmFwaE5vZGVbXSxcclxuICAgIHBhdGg/OiBHcmFwaE5vZGVbXSxcclxuICAgIGZyaW5nZT86IFByaW9yaXR5UXVldWU8R3JhcGhOb2RlPlxyXG59O1xyXG5cclxuY29uc3QgdW5pZm9ybUNvc3RTZWFyY2g6IFNlYXJjaEZ1bmN0aW9uID0gKHN0YXJ0LCBnb2FsKSA9PlxyXG4gICAgYmVzdEZpcnN0U2VhcmNoKHN0YXJ0LCBnb2FsLCAoeyBwYXJlbnRTY29yZSwgZGlzdGFuY2UgfSkgPT4gcGFyZW50U2NvcmUgKyBkaXN0YW5jZSk7XHJcblxyXG5jb25zdCBncmVlZHlTZWFyY2g6IFNlYXJjaEZ1bmN0aW9uID0gKHN0YXJ0LCBnb2FsKSA9PlxyXG4gICAgYmVzdEZpcnN0U2VhcmNoKHN0YXJ0LCBnb2FsLCAoeyBub2RlIH0pID0+IGRpc3RhbmNlQmV0d2Vlbihub2RlLCBnb2FsKSk7XHJcblxyXG5jb25zdCBhU3RhclNlYXJjaDogU2VhcmNoRnVuY3Rpb24gPSAoc3RhcnQsIGdvYWwpID0+XHJcbiAgICBiZXN0Rmlyc3RTZWFyY2goc3RhcnQsIGdvYWwsICh7IG5vZGUsIHBhcmVudFNjb3JlLCBkaXN0YW5jZSB9KSA9PlxyXG4gICAgICAgIHBhcmVudFNjb3JlICsgZGlzdGFuY2UgKyBkaXN0YW5jZUJldHdlZW4obm9kZSwgZ29hbCkpO1xyXG5cclxuZnVuY3Rpb24gYmVzdEZpcnN0U2VhcmNoKHN0YXJ0OiBHcmFwaE5vZGUsIGdvYWw6IEdyYXBoTm9kZSxcclxuc2NvcmVGdW5jOiBTY29yaW5nRnVuY3Rpb24pOiBTZWFyY2hSZXN1bHQge1xyXG4gICAgY29uc3QgZXhwYW5kZWQ6IEdyYXBoTm9kZVtdID0gW107XHJcbiAgICBjb25zdCBzY29yZXMgPSBuZXcgTWFwPElkLCBTY29yZT4oW1tzdGFydC5pZCwgc2NvcmVGdW5jKHtcclxuICAgICAgICBub2RlOiBzdGFydCxcclxuICAgICAgICBwYXJlbnRTY29yZTogMCxcclxuICAgICAgICBkaXN0YW5jZTogMFxyXG4gICAgfSldXSk7XHJcbiAgICBjb25zdCBwYXJlbnRzID0gbmV3IE1hcDxJZCwgR3JhcGhOb2RlPigpO1xyXG4gICAgY29uc3QgZnJpbmdlID0gbmV3IFByaW9yaXR5UXVldWU8R3JhcGhOb2RlPih7XHJcbiAgICAgICAgY29tcGFyYXRvcjogKGE6IEdyYXBoTm9kZSwgYjogR3JhcGhOb2RlKSA9PiBzY29yZXMuZ2V0KGEuaWQpIC0gc2NvcmVzLmdldChiLmlkKSxcclxuICAgICAgICBpbml0aWFsVmFsdWVzOiBbc3RhcnRdXHJcbiAgICB9KTtcclxuICAgIHdoaWxlIChmcmluZ2UubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSBmcmluZ2UuZGVxdWV1ZSgpO1xyXG4gICAgICAgIGlmIChleHBhbmRlZC5pbmNsdWRlcyhjdXJyZW50KSkge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZXhwYW5kZWQucHVzaChjdXJyZW50KTtcclxuICAgICAgICBjb25zdCBjdXJyZW50U2NvcmUgPSBzY29yZXMuZ2V0KGN1cnJlbnQuaWQpIGFzIFNjb3JlO1xyXG4gICAgICAgIGlmIChjdXJyZW50ID09PSBnb2FsKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhdGggPSBbZ29hbF07XHJcbiAgICAgICAgICAgIGxldCBwYXJlbnQgPSBnb2FsO1xyXG4gICAgICAgICAgICB3aGlsZSAocGFyZW50ICE9PSBzdGFydCkge1xyXG4gICAgICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50cy5nZXQocGFyZW50LmlkKSBhcyBHcmFwaE5vZGU7XHJcbiAgICAgICAgICAgICAgICBwYXRoLnVuc2hpZnQocGFyZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4geyBleHBhbmRlZCwgcGF0aCwgZnJpbmdlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoY29uc3QgeyBkaXN0YW5jZSwgY2hpbGQgfSBvZiBjdXJyZW50LmNvbm5lY3Rpb25zKSB7XHJcbiAgICAgICAgICAgIGlmIChleHBhbmRlZC5pbmNsdWRlcyhjaGlsZCkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IG9sZENoaWxkU2NvcmUgPSBzY29yZXMuZ2V0KGNoaWxkLmlkKTtcclxuICAgICAgICAgICAgY29uc3QgbmV3Q2hpbGRTY29yZSA9IHNjb3JlRnVuYyh7XHJcbiAgICAgICAgICAgICAgICBub2RlOiBjaGlsZCxcclxuICAgICAgICAgICAgICAgIHBhcmVudFNjb3JlOiBjdXJyZW50U2NvcmUsXHJcbiAgICAgICAgICAgICAgICBkaXN0YW5jZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKG9sZENoaWxkU2NvcmUgPT09IHVuZGVmaW5lZCB8fCBuZXdDaGlsZFNjb3JlIDwgb2xkQ2hpbGRTY29yZSkge1xyXG4gICAgICAgICAgICAgICAgc2NvcmVzLnNldChjaGlsZC5pZCwgbmV3Q2hpbGRTY29yZSk7XHJcbiAgICAgICAgICAgICAgICBwYXJlbnRzLnNldChjaGlsZC5pZCwgY3VycmVudCk7XHJcbiAgICAgICAgICAgICAgICBmcmluZ2UucXVldWUoY2hpbGQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHsgZXhwYW5kZWQgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gZGlzdGFuY2VCZXR3ZWVuKGE6IEdyYXBoTm9kZSwgYjogR3JhcGhOb2RlKSB7XHJcbiAgICByZXR1cm4gTWF0aC5zcXJ0KE1hdGgucG93KGEubGF0IC0gYi5sYXQsIDIpICsgTWF0aC5wb3coYS5sbmcgLSBiLmxuZywgMikpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvdmVycGFzc1RvR3JhcGhOb2Rlcyh7IGVsZW1lbnRzIH06IE92ZXJwYXNzSlNPTikge1xyXG4gICAgY29uc3QgZ3JhcGhOb2RlczogR3JhcGhOb2RlW10gPSBbXTtcclxuICAgIGZvciAoY29uc3QgeyBub2RlcywgZ2VvbWV0cnksIHRhZ3M6IHsganVuY3Rpb24gfSB9IG9mIGVsZW1lbnRzKSB7XHJcbiAgICAgICAgbGV0IHByZXZHcmFwaE5vZGU6IEdyYXBoTm9kZTtcclxuICAgICAgICBsZXQgZmlyc3RHcmFwaE5vZGU6IEdyYXBoTm9kZTtcclxuICAgICAgICBub2Rlcy5mb3JFYWNoKChub2RlSWQsIGkpID0+IHtcclxuICAgICAgICAgICAgbGV0IGdyYXBoTm9kZSA9IGdyYXBoTm9kZXMuZmluZChncmFwaE5vZGUgPT4gZ3JhcGhOb2RlLmlkID09PSBub2RlSWQpO1xyXG4gICAgICAgICAgICBpZiAoZ3JhcGhOb2RlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGdyYXBoTm9kZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogbm9kZUlkLFxyXG4gICAgICAgICAgICAgICAgICAgIGxhdDogZ2VvbWV0cnlbaV0ubGF0LFxyXG4gICAgICAgICAgICAgICAgICAgIGxuZzogZ2VvbWV0cnlbaV0ubG9uLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25zOiBbXSBhcyBDb25uZWN0aW9uW11cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBncmFwaE5vZGVzLnB1c2goZ3JhcGhOb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgZmlyc3RHcmFwaE5vZGUgPSBncmFwaE5vZGU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25uZWN0KGdyYXBoTm9kZSwgcHJldkdyYXBoTm9kZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGkgPT09IG5vZGVzLmxlbmd0aCAtIDEgJiYganVuY3Rpb24gPT09ICdyb3VuZGFib3V0Jykge1xyXG4gICAgICAgICAgICAgICAgY29ubmVjdChncmFwaE5vZGUsIGZpcnN0R3JhcGhOb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwcmV2R3JhcGhOb2RlID0gZ3JhcGhOb2RlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGdyYXBoTm9kZXM7XHJcbiAgICBmdW5jdGlvbiBjb25uZWN0KGE6IEdyYXBoTm9kZSwgYjogR3JhcGhOb2RlKSB7XHJcbiAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBkaXN0YW5jZUJldHdlZW4oYSwgYik7XHJcbiAgICAgICAgYS5jb25uZWN0aW9ucy5wdXNoKHsgZGlzdGFuY2UsIGNoaWxkOiBiIH0pO1xyXG4gICAgICAgIGIuY29ubmVjdGlvbnMucHVzaCh7IGRpc3RhbmNlLCBjaGlsZDogYSB9KTtcclxuICAgIH1cclxufSIsIid1c2Ugc3RyaWN0JztcclxuXHJcbm9uZXJyb3IgPSBhbGVydDtcclxuXHJcbigoKSA9PiB7XHJcblxyXG4gICAgY29uc3QgcXM6IHR5cGVvZiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvci5iaW5kKGRvY3VtZW50KTtcclxuICAgIGNvbnN0IHFzYTogdHlwZW9mIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsLmJpbmQoZG9jdW1lbnQpO1xyXG5cclxuICAgIGNvbnN0IGludHJvU2NyZWVuID0gcXMoJyNpbnRyby1zY3JlZW4nKSBhcyBIVE1MRWxlbWVudDtcclxuICAgIGNvbnN0IHF1ZXJ5QnV0dG9uID0gcXMoJyNxdWVyeS1idXR0b24nKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcclxuICAgIGNvbnN0IGFyZWFUb29CaWcgPSBxcygnI2FyZWEtdG9vLWJpZy13YXJuaW5nJykgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICBjb25zdCBxdWVyeWluZ1NjcmVlbiA9IHFzKCcjcXVlcnlpbmctc2NyZWVuJykgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICBjb25zdCBjaG9vc2VTY3JlZW4gPSBxcygnI2Nob29zZS1zY3JlZW4nKSBhcyBIVE1MRWxlbWVudDtcclxuICAgIGNvbnN0IG5vZGVzQ3JlYXRlZEVsZW0gPSBxcygnI25vZGVzLWNyZWF0ZWQnKTtcclxuICAgIGNvbnN0IHN0YXJ0Tm9kZUlkRWxlbSA9IHFzKCcjc3RhcnQtbm9kZS1pZCcpO1xyXG4gICAgY29uc3QgZ29hbE5vZGVJZEVsZW0gPSBxcygnI2dvYWwtbm9kZS1pZCcpO1xyXG4gICAgY29uc3Qgc2VhcmNoQnV0dG9uID0gcXMoJyNzZWFyY2gtYnV0dG9uJykgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XHJcbiAgICBjb25zdCByZXN1bHRzU2NyZWVuID0gcXMoJyNyZXN1bHRzLXNjcmVlbicpIGFzIEhUTUxFbGVtZW50O1xyXG4gICAgY29uc3QgcGF0aFJlc3VsdCA9IHFzKCcjcGF0aC1yZXN1bHQnKTtcclxuICAgIGNvbnN0IGV4cGFuZGVkUmVzdWx0ID0gcXMoJyNleHBhbmRlZC1yZXN1bHQnKTtcclxuICAgIGNvbnN0IGZyaW5nZVJlc3VsdCA9IHFzKCcjZnJpbmdlLXJlc3VsdCcpO1xyXG4gICAgY29uc3QgYmFja0J1dHRvbiA9IHFzKCcjYmFjay1idXR0b24nKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcclxuXHJcbiAgICBjb25zdCBzaWRlYmFySXRlbXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChxc2EoJyNzaWRlYmFyID4gKicpKSBhcyBIVE1MRWxlbWVudFtdO1xyXG5cclxuICAgIGNvbnN0IGNvbG9ycyA9IHtcclxuICAgICAgICBkZWZhdWx0OiAnIzMzODhmZicsXHJcbiAgICAgICAgc3RhcnQ6ICdyZWQnLFxyXG4gICAgICAgIGdvYWw6ICdncmVlbicsXHJcbiAgICAgICAgZXhwYW5kZWQ6ICdkYXJrYmx1ZScsXHJcbiAgICAgICAgcGF0aDogJyMwMDk2ODgnLFxyXG4gICAgICAgIGZyaW5nZTogJ29yYW5nZSdcclxuICAgIH07XHJcblxyXG4gICAgbGV0IG1hcDogTC5NYXA7XHJcblxyXG4gICAgbGV0IHN0YXJ0Tm9kZTogR3JhcGhOb2RlIHwgbnVsbCA9IG51bGw7XHJcbiAgICBsZXQgZ29hbE5vZGU6IEdyYXBoTm9kZSB8IG51bGwgPSBudWxsO1xyXG4gICAgbGV0IHNlYXJjaEZ1bmN0aW9uOiBTZWFyY2hGdW5jdGlvbjtcclxuXHJcbiAgICBxdWVyeUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHF1ZXJ5KTtcclxuICAgIHNlYXJjaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlYXJjaCk7XHJcblxyXG4gICAgY29uc3QgcmFkaW9Ub0Z1bmN0aW9uOiB7IFtpZDogc3RyaW5nXTogU2VhcmNoRnVuY3Rpb24gfSA9IHtcclxuICAgICAgICAndW5pZm9ybS1jb3N0LXJhZGlvJzogdW5pZm9ybUNvc3RTZWFyY2gsXHJcbiAgICAgICAgJ2dyZWVkeS1yYWRpbyc6IGdyZWVkeVNlYXJjaCxcclxuICAgICAgICAnYS1zdGFyLXJhZGlvJzogYVN0YXJTZWFyY2hcclxuICAgIH07XHJcbiAgICBmb3IgKGNvbnN0IGlkIGluIHJhZGlvVG9GdW5jdGlvbikge1xyXG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyMnICsgaWQpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBzZWFyY2hGdW5jdGlvbiA9IHJhZGlvVG9GdW5jdGlvbltpZF07XHJcbiAgICAgICAgICAgIGNoZWNrU2VhcmNoQnV0dG9uKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYmFja0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNob29zZUFnYWluKTtcclxuXHJcbiAgICBjb25zdCBub2RlSWRUb0NpcmNsZSA9IG5ldyBNYXA8bnVtYmVyLCBMLkNpcmNsZT4oKTtcclxuXHJcbiAgICBsZXQgcGF0aExpbmU6IEwuUG9seWxpbmUgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKFxyXG4gICAgICAgIHBvcyA9PiBpbml0KHBvcy5jb29yZHMubGF0aXR1ZGUsIHBvcy5jb29yZHMubG9uZ2l0dWRlKSxcclxuICAgICAgICAoKSA9PiBpbml0KDI1LjExNjAzNSwgMTIxLjUyOTk0NikgLy8gZmFsbGJhY2sgdG8gVEFTXHJcbiAgICApO1xyXG5cclxuICAgIGZ1bmN0aW9uIGluaXQobGF0OiBudW1iZXIsIGxuZzogbnVtYmVyKSB7XHJcblxyXG4gICAgICAgIG1hcCA9IEwubWFwKCdtYXAnLCB7XHJcbiAgICAgICAgICAgIGNlbnRlcjogW2xhdCwgbG5nXSxcclxuICAgICAgICAgICAgem9vbTogMTcsXHJcbiAgICAgICAgICAgIHdvcmxkQ29weUp1bXA6IHRydWVcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgTC50aWxlTGF5ZXIoJ2h0dHA6Ly97c30udGlsZS5vc20ub3JnL3t6fS97eH0ve3l9LnBuZycsIHtcclxuICAgICAgICAgICAgYXR0cmlidXRpb246ICcmY29weTsgPGEgaHJlZj1cImh0dHA6Ly9vc20ub3JnL2NvcHlyaWdodFwiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycycsXHJcbiAgICAgICAgICAgIG1heFpvb206IDIxLFxyXG4gICAgICAgICAgICBtYXhOYXRpdmVab29tOiAxOVxyXG4gICAgICAgIH0pLmFkZFRvKG1hcCk7XHJcblxyXG4gICAgICAgIG1hcC5vbignem9vbScsICgpID0+IHtcclxuICAgICAgICAgICAgaWYgKG1hcC5nZXRab29tKCkgPCAxMykge1xyXG4gICAgICAgICAgICAgICAgcXVlcnlCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgc2hvd0VsZW0oYXJlYVRvb0JpZyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBxdWVyeUJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaGlkZUVsZW0oYXJlYVRvb0JpZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc2hvd09ubHkoaW50cm9TY3JlZW4pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBxdWVyeSgpIHtcclxuXHJcbiAgICAgICAgc2hvd09ubHkocXVlcnlpbmdTY3JlZW4pO1xyXG5cclxuICAgICAgICBjb25zdCBib3VuZHMgPSBtYXAuZ2V0Qm91bmRzKCk7XHJcbiAgICAgICAgY29uc3Qgb3ZlcnBhc3NRTCA9IGBbb3V0Ompzb25dO3dheVtoaWdod2F5XSgke2JvdW5kcy5nZXRTb3V0aCgpfSwke2JvdW5kcy5nZXRXZXN0KCl9LCR7Ym91bmRzLmdldE5vcnRoKCl9LCR7Ym91bmRzLmdldEVhc3QoKX0pO291dCBnZW9tO2A7XHJcblxyXG4gICAgICAgIGZldGNoKCdodHRwczovL292ZXJwYXNzLWFwaS5kZS9hcGkvaW50ZXJwcmV0ZXI/ZGF0YT0nICsgb3ZlcnBhc3NRTClcclxuICAgICAgICAgICAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXHJcbiAgICAgICAgICAgIC50aGVuKGNyZWF0ZU5vZGVzKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY3JlYXRlTm9kZXMoZGF0YTogT3ZlcnBhc3NKU09OKSB7XHJcblxyXG4gICAgICAgIGNvbnN0IG5vZGVzID0gb3ZlcnBhc3NUb0dyYXBoTm9kZXMoZGF0YSk7XHJcblxyXG4gICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlcykge1xyXG5cclxuICAgICAgICAgICAgY29uc3QgY2lyY2xlID0gTC5jaXJjbGUobm9kZSwge1xyXG4gICAgICAgICAgICAgICAgcmFkaXVzOiA2LFxyXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAwLjcsXHJcbiAgICAgICAgICAgICAgICBjb2xvcjogY29sb3JzLmRlZmF1bHRcclxuICAgICAgICAgICAgfSkuYmluZFBvcHVwKCgpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgaWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgIGlkLnRleHRDb250ZW50ID0gbm9kZS5pZC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgZWxlbS5hcHBlbmRDaGlsZChpZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRMaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICAgICAgICAgICAgc3RhcnRMaW5rLmhyZWYgPSAnIyc7XHJcbiAgICAgICAgICAgICAgICBzdGFydExpbmsudGV4dENvbnRlbnQgPSAnU2V0IGFzIHN0YXJ0JztcclxuICAgICAgICAgICAgICAgIHN0YXJ0TGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZSA9PT0gZ29hbE5vZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ29hbE5vZGUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnb2FsTm9kZUlkRWxlbS50ZXh0Q29udGVudCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAobm9kZUlkVG9DaXJjbGUuZ2V0KG5vZGUuaWQpIGFzIEwuQ2lyY2xlKS5zZXRTdHlsZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogY29sb3JzLmRlZmF1bHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGFydE5vZGUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgKG5vZGVJZFRvQ2lyY2xlLmdldChzdGFydE5vZGUuaWQpIGFzIEwuQ2lyY2xlKS5zZXRTdHlsZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogY29sb3JzLmRlZmF1bHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0Tm9kZSA9IG5vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnROb2RlSWRFbGVtLnRleHRDb250ZW50ID0gc3RhcnROb2RlLmlkLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tTZWFyY2hCdXR0b24oKTtcclxuICAgICAgICAgICAgICAgICAgICBjaXJjbGUuY2xvc2VQb3B1cCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIChjaXJjbGUgYXMgTC5DaXJjbGUpLnNldFN0eWxlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGNvbG9ycy5zdGFydFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBlbGVtLmFwcGVuZENoaWxkKHN0YXJ0TGluayk7XHJcblxyXG4gICAgICAgICAgICAgICAgZWxlbS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdicicpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBnb2FsTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICAgICAgICAgIGdvYWxMaW5rLmhyZWYgPSAnIyc7XHJcbiAgICAgICAgICAgICAgICBnb2FsTGluay50ZXh0Q29udGVudCA9ICdTZXQgYXMgZ29hbCc7XHJcbiAgICAgICAgICAgICAgICBnb2FsTGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZSA9PT0gc3RhcnROb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Tm9kZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Tm9kZUlkRWxlbS50ZXh0Q29udGVudCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAobm9kZUlkVG9DaXJjbGUuZ2V0KG5vZGUuaWQpIGFzIEwuQ2lyY2xlKS5zZXRTdHlsZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogY29sb3JzLmRlZmF1bHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChnb2FsTm9kZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAobm9kZUlkVG9DaXJjbGUuZ2V0KGdvYWxOb2RlLmlkKSBhcyBMLkNpcmNsZSkuc2V0U3R5bGUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGNvbG9ycy5kZWZhdWx0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBnb2FsTm9kZSA9IG5vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgZ29hbE5vZGVJZEVsZW0udGV4dENvbnRlbnQgPSBnb2FsTm9kZS5pZC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrU2VhcmNoQnV0dG9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2lyY2xlLmNsb3NlUG9wdXAoKTtcclxuICAgICAgICAgICAgICAgICAgICAoY2lyY2xlIGFzIEwuQ2lyY2xlKS5zZXRTdHlsZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBjb2xvcnMuZ29hbFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBlbGVtLmFwcGVuZENoaWxkKGdvYWxMaW5rKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbTtcclxuXHJcbiAgICAgICAgICAgIH0pLmFkZFRvKG1hcCk7XHJcblxyXG4gICAgICAgICAgICBub2RlSWRUb0NpcmNsZS5zZXQobm9kZS5pZCwgY2lyY2xlKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBub2Rlc0NyZWF0ZWRFbGVtLnRleHRDb250ZW50ID0gbm9kZXMubGVuZ3RoLnRvU3RyaW5nKCk7XHJcblxyXG4gICAgICAgIHNob3dPbmx5KGNob29zZVNjcmVlbik7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNlYXJjaCgpIHtcclxuXHJcbiAgICAgICAgY29uc3QgeyBleHBhbmRlZCwgcGF0aCwgZnJpbmdlIH0gPVxyXG4gICAgICAgICAgICBzZWFyY2hGdW5jdGlvbihzdGFydE5vZGUgYXMgR3JhcGhOb2RlLCBnb2FsTm9kZSBhcyBHcmFwaE5vZGUpO1xyXG5cclxuICAgICAgICBleHBhbmRlZFJlc3VsdC50ZXh0Q29udGVudCA9IGV4cGFuZGVkLmxlbmd0aC50b1N0cmluZygpO1xyXG4gICAgICAgIGZvciAoY29uc3QgZXhwIG9mIGV4cGFuZGVkKSB7XHJcbiAgICAgICAgICAgIChub2RlSWRUb0NpcmNsZS5nZXQoZXhwLmlkKSBhcyBMLkNpcmNsZSkuc2V0U3R5bGUoe1xyXG4gICAgICAgICAgICAgICAgY29sb3I6IGNvbG9ycy5leHBhbmRlZFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChwYXRoID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcGF0aFJlc3VsdC50ZXh0Q29udGVudCA9ICdQYXRoIG5vdCBmb3VuZC4nO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHBhdGhSZXN1bHQudGV4dENvbnRlbnQgPSBgUGF0aCBmb3VuZCB3aXRoICR7cGF0aC5sZW5ndGh9IG5vZGVzLmA7XHJcbiAgICAgICAgICAgIHBhdGhMaW5lID0gTC5wb2x5bGluZShwYXRoLCB7XHJcbiAgICAgICAgICAgICAgICB3ZWlnaHQ6IDgsXHJcbiAgICAgICAgICAgICAgICBjb2xvcjogY29sb3JzLnBhdGhcclxuICAgICAgICAgICAgfSkuYWRkVG8obWFwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChmcmluZ2UgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBmcmluZ2VSZXN1bHQudGV4dENvbnRlbnQgPSAnTm8nO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGZyaW5nZVJlc3VsdC50ZXh0Q29udGVudCA9IGZyaW5nZS5sZW5ndGgudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgd2hpbGUgKGZyaW5nZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAobm9kZUlkVG9DaXJjbGUuZ2V0KGZyaW5nZS5kZXF1ZXVlKCkuaWQpIGFzIEwuQ2lyY2xlKS5zZXRTdHlsZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IGNvbG9ycy5mcmluZ2VcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzaG93T25seShyZXN1bHRzU2NyZWVuKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY2hvb3NlQWdhaW4oKSB7XHJcblxyXG4gICAgICAgIGZvciAoY29uc3QgY2lyY2xlIG9mIG5vZGVJZFRvQ2lyY2xlLnZhbHVlcygpKSB7XHJcbiAgICAgICAgICAgIGNpcmNsZS5zZXRTdHlsZSh7XHJcbiAgICAgICAgICAgICAgICBjb2xvcjogY29sb3JzLmRlZmF1bHRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmIChwYXRoTGluZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcGF0aExpbmUucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICBwYXRoTGluZSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNob3dPbmx5KGNob29zZVNjcmVlbik7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNoZWNrU2VhcmNoQnV0dG9uKCkge1xyXG4gICAgICAgIHNlYXJjaEJ1dHRvbi5kaXNhYmxlZCA9ICEoc3RhcnROb2RlICYmIGdvYWxOb2RlICYmIHNlYXJjaEZ1bmN0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBzaG93T25seShlbGVtOiBIVE1MRWxlbWVudCkge1xyXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBzaWRlYmFySXRlbXMpIHtcclxuICAgICAgICAgICAgaGlkZUVsZW0oaXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNob3dFbGVtKGVsZW0pO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNob3dFbGVtKGVsZW06IEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAgZWxlbS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gaGlkZUVsZW0oZWxlbTogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICB9XHJcblxyXG59KSgpOyJdfQ==