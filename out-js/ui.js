'use strict';
onerror = alert;
navigator.geolocation.getCurrentPosition(function (pos) { return init(pos.coords.latitude, pos.coords.longitude); }, function () { return init(25.116035, 121.529946); } // fallback to TAS
);
function init(lat, lng) {
    var qs = document.querySelector.bind(document);
    var introScreen = qs('#intro-screen');
    var queryButton = qs('#query-button');
    var queryingScreen = qs('#querying-screen');
    var queryState = qs('#query-state');
    var chooseScreen = qs('#choose-screen');
    var startNodeIdElem = qs('#start-node-id');
    var goalNodeIdElem = qs('#goal-node-id');
    var searchButton = qs('#search-button');
    var resultsScreen = qs('#results-screen');
    var searchProgress = qs('#search-progress');
    var searchState = qs('#search-state');
    var map = L.map('map', {
        center: [lat, lng],
        zoom: 17,
        minZoom: 12
    });
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 21,
        maxNativeZoom: 19
    }).addTo(map);
    showElem(introScreen);
    queryButton.addEventListener('click', function () {
        hideElem(introScreen);
        showElem(queryingScreen);
        queryState.textContent = 'Querying Overpass API...';
        var bounds = map.getBounds();
        var query = "\n            [out:json];\n            way [highway] (\n                " + bounds.getSouth() + ",\n                " + bounds.getWest() + ",\n                " + bounds.getNorth() + ",\n                " + bounds.getEast() + "\n            );\n            out geom;\n        ";
        fetch('https://overpass-api.de/api/interpreter?data=' + query)
            .then(function (res) { return res.json(); })
            .then(function (data) {
            queryState.textContent = 'Creating nodes...';
            var nodes = overpassToGraphNodes(data);
            var startNode;
            var goalNode;
            var searchFunction;
            var defaultCircleStyle = {
                radius: 6,
                stroke: false,
                fillOpacity: 0.7
            };
            var nodeIdToCircle = new Map(nodes.map(function (node) { return [
                node.id,
                L.circle(node, defaultCircleStyle).bindPopup(function (circle) {
                    var elem = document.createElement('div');
                    var id = document.createElement('div');
                    id.textContent = node.id.toString();
                    elem.appendChild(id);
                    var startLink = document.createElement('a');
                    startLink.href = '#';
                    startLink.textContent = 'Set as start';
                    startLink.addEventListener('click', function () {
                        if (node === goalNode) {
                            return;
                        }
                        if (startNode !== undefined) {
                            nodeIdToCircle.get(startNode.id)
                                .setStyle(defaultCircleStyle);
                        }
                        startNode = node;
                        startNodeIdElem.textContent = startNode.id.toString();
                        checkSearchButton();
                        circle.closePopup();
                        circle.setStyle(Object.assign({
                            color: 'red'
                        }, defaultCircleStyle));
                    });
                    elem.appendChild(startLink);
                    elem.appendChild(document.createElement('br'));
                    var goalLink = document.createElement('a');
                    goalLink.href = '#';
                    goalLink.textContent = 'Set as goal';
                    goalLink.addEventListener('click', function () {
                        if (node === startNode) {
                            return;
                        }
                        if (goalNode !== undefined) {
                            nodeIdToCircle.get(goalNode.id)
                                .setStyle(defaultCircleStyle);
                        }
                        goalNode = node;
                        goalNodeIdElem.textContent = goalNode.id.toString();
                        checkSearchButton();
                        circle.closePopup();
                        circle.setStyle(Object.assign({
                            color: 'green'
                        }, defaultCircleStyle));
                    });
                    elem.appendChild(goalLink);
                    return elem;
                }).addTo(map)
            ]; }));
            var radioToFunction = {
                'uniform-cost-radio': uniformCostSearch,
                'greedy-radio': greedySearch,
                'a-star-radio': aStarSearch
            };
            var _loop_1 = function(id) {
                document.querySelector('#' + id).addEventListener('click', function () {
                    searchFunction = radioToFunction[id];
                    checkSearchButton();
                });
            };
            for (var id in radioToFunction) {
                _loop_1(id);
            }
            queryState.textContent = '';
            hideElem(queryingScreen);
            showElem(chooseScreen);
            console.log(nodes.length + ' nodes created');
            function checkSearchButton() {
                searchButton.disabled = !(startNode && goalNode && searchFunction);
            }
            searchButton.addEventListener('click', function () {
                hideElem(chooseScreen);
                showElem(resultsScreen);
                searchProgress.classList.add('mdl-progress__indeterminate');
                searchState.textContent = 'Searching...';
                var res = searchFunction(startNode, goalNode);
                searchProgress.classList.remove('mdl-progress__indeterminate');
                if (res === null) {
                    searchState.textContent = 'Path not found';
                }
                else {
                    searchState.textContent = "Path found, " + res.expanded.length + " nodes expanded, path is " + res.path.length + " nodes long";
                    for (var _i = 0, _a = res.expanded; _i < _a.length; _i++) {
                        var expanded = _a[_i];
                        nodeIdToCircle.get(expanded.id)
                            .setStyle(Object.assign({
                            color: 'darkblue'
                        }, defaultCircleStyle));
                    }
                    L.polyline(res.path, {
                        weight: 8,
                        color: 'darkblue'
                    }).addTo(map);
                    console.log(res);
                }
            });
        });
    });
    function showElem(elem) {
        elem.style.display = 'block';
    }
    function hideElem(elem) {
        elem.style.display = 'none';
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidWkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMtdHMvdWkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBRWIsT0FBTyxHQUFHLEtBQUssQ0FBQztBQUVoQixTQUFTLENBQUMsV0FBVyxDQUFDLGtCQUFrQixDQUNwQyxVQUFBLEdBQUcsSUFBSSxPQUFBLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxFQUEvQyxDQUErQyxFQUN0RCxjQUFNLE9BQUEsSUFBSSxDQUFDLFNBQVMsRUFBRSxVQUFVLENBQUMsRUFBM0IsQ0FBMkIsQ0FBQyxrQkFBa0I7Q0FDdkQsQ0FBQztBQUVGLGNBQWMsR0FBVyxFQUFFLEdBQVc7SUFDbEMsSUFBTSxFQUFFLEdBQWtDLFFBQVEsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ2hGLElBQU0sV0FBVyxHQUFHLEVBQUUsQ0FBQyxlQUFlLENBQWdCLENBQUM7SUFDdkQsSUFBTSxXQUFXLEdBQUcsRUFBRSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQ3hDLElBQU0sY0FBYyxHQUFHLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBZ0IsQ0FBQztJQUM3RCxJQUFNLFVBQVUsR0FBRyxFQUFFLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDdEMsSUFBTSxZQUFZLEdBQUcsRUFBRSxDQUFDLGdCQUFnQixDQUFnQixDQUFDO0lBQ3pELElBQU0sZUFBZSxHQUFHLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQzdDLElBQU0sY0FBYyxHQUFHLEVBQUUsQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUMzQyxJQUFNLFlBQVksR0FBRyxFQUFFLENBQUMsZ0JBQWdCLENBQXNCLENBQUM7SUFDL0QsSUFBTSxhQUFhLEdBQUcsRUFBRSxDQUFDLGlCQUFpQixDQUFnQixDQUFDO0lBQzNELElBQU0sY0FBYyxHQUFH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VTtxQkFDcEIsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDZCxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNyQixDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNYLENBQUMsQ0FBQyxDQUFDO0lBQ0gsa0JBQWtCLElBQWlCO1FBQy9CLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztJQUNqQyxDQUFDO0lBQ0Qsa0JBQWtCLElBQWlCO1FBQy9CLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztJQUNoQyxDQUFDO0FBQ0wsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbm9uZXJyb3IgPSBhbGVydDtcclxuXHJcbm5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24oXHJcbiAgICBwb3MgPT4gaW5pdChwb3MuY29vcmRzLmxhdGl0dWRlLCBwb3MuY29vcmRzLmxvbmdpdHVkZSksXHJcbiAgICAoKSA9PiBpbml0KDI1LjExNjAzNSwgMTIxLjUyOTk0NikgLy8gZmFsbGJhY2sgdG8gVEFTXHJcbik7XHJcblxyXG5mdW5jdGlvbiBpbml0KGxhdDogbnVtYmVyLCBsbmc6IG51bWJlcikge1xyXG4gICAgY29uc3QgcXM6IHR5cGVvZiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvci5iaW5kKGRvY3VtZW50KTtcclxuICAgIGNvbnN0IGludHJvU2NyZWVuID0gcXMoJyNpbnRyby1zY3JlZW4nKSBhcyBIVE1MRWxlbWVudDtcclxuICAgIGNvbnN0IHF1ZXJ5QnV0dG9uID0gcXMoJyNxdWVyeS1idXR0b24nKTtcclxuICAgIGNvbnN0IHF1ZXJ5aW5nU2NyZWVuID0gcXMoJyNxdWVyeWluZy1zY3JlZW4nKSBhcyBIVE1MRWxlbWVudDtcclxuICAgIGNvbnN0IHF1ZXJ5U3RhdGUgPSBxcygnI3F1ZXJ5LXN0YXRlJyk7XHJcbiAgICBjb25zdCBjaG9vc2VTY3JlZW4gPSBxcygnI2Nob29zZS1zY3JlZW4nKSBhcyBIVE1MRWxlbWVudDtcclxuICAgIGNvbnN0IHN0YXJ0Tm9kZUlkRWxlbSA9IHFzKCcjc3RhcnQtbm9kZS1pZCcpO1xyXG4gICAgY29uc3QgZ29hbE5vZGVJZEVsZW0gPSBxcygnI2dvYWwtbm9kZS1pZCcpO1xyXG4gICAgY29uc3Qgc2VhcmNoQnV0dG9uID0gcXMoJyNzZWFyY2gtYnV0dG9uJykgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XHJcbiAgICBjb25zdCByZXN1bHRzU2NyZWVuID0gcXMoJyNyZXN1bHRzLXNjcmVlbicpIGFzIEhUTUxFbGVtZW50O1xyXG4gICAgY29uc3Qgc2VhcmNoUHJvZ3Jlc3MgPSBxcygnI3NlYXJjaC1wcm9ncmVzcycpO1xyXG4gICAgY29uc3Qgc2VhcmNoU3RhdGUgPSBxcygnI3NlYXJjaC1zdGF0ZScpO1xyXG4gICAgY29uc3QgbWFwID0gTC5tYXAoJ21hcCcsIHtcclxuICAgICAgICBjZW50ZXI6IFtsYXQsIGxuZ10sXHJcbiAgICAgICAgem9vbTogMTcsXHJcbiAgICAgICAgbWluWm9vbTogMTJcclxuICAgIH0pO1xyXG4gICAgTC50aWxlTGF5ZXIoJ2h0dHA6Ly97c30udGlsZS5vc20ub3JnL3t6fS97eH0ve3l9LnBuZycsIHtcclxuICAgICAgICBhdHRyaWJ1dGlvbjogJyZjb3B5OyA8YSBocmVmPVwiaHR0cDovL29zbS5vcmcvY29weXJpZ2h0XCI+T3BlblN0cmVldE1hcDwvYT4gY29udHJpYnV0b3JzJyxcclxuICAgICAgICBtYXhab29tOiAyMSxcclxuICAgICAgICBtYXhOYXRpdmVab29tOiAxOVxyXG4gICAgfSkuYWRkVG8obWFwKTtcclxuICAgIHNob3dFbGVtKGludHJvU2NyZWVuKTtcclxuICAgIHF1ZXJ5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgIGhpZGVFbGVtKGludHJvU2NyZWVuKTtcclxuICAgICAgICBzaG93RWxlbShxdWVyeWluZ1NjcmVlbik7XHJcbiAgICAgICAgcXVlcnlTdGF0ZS50ZXh0Q29udGVudCA9ICdRdWVyeWluZyBPdmVycGFzcyBBUEkuLi4nO1xyXG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IG1hcC5nZXRCb3VuZHMoKTtcclxuICAgICAgICBjb25zdCBxdWVyeSA9IGBcclxuICAgICAgICAgICAgW291dDpqc29uXTtcclxuICAgICAgICAgICAgd2F5IFtoaWdod2F5XSAoXHJcbiAgICAgICAgICAgICAgICAke2JvdW5kcy5nZXRTb3V0aCgpfSxcclxuICAgICAgICAgICAgICAgICR7Ym91bmRzLmdldFdlc3QoKX0sXHJcbiAgICAgICAgICAgICAgICAke2JvdW5kcy5nZXROb3J0aCgpfSxcclxuICAgICAgICAgICAgICAgICR7Ym91bmRzLmdldEVhc3QoKX1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgb3V0IGdlb207XHJcbiAgICAgICAgYDtcclxuICAgICAgICBmZXRjaCgnaHR0cHM6Ly9vdmVycGFzcy1hcGkuZGUvYXBpL2ludGVycHJldGVyP2RhdGE9JyArIHF1ZXJ5KVxyXG4gICAgICAgICAgICAudGhlbihyZXMgPT4gcmVzLmpzb24oKSlcclxuICAgICAgICAgICAgLnRoZW4oKGRhdGE6IE92ZXJwYXNzSlNPTikgPT4ge1xyXG4gICAgICAgICAgICAgICAgcXVlcnlTdGF0ZS50ZXh0Q29udGVudCA9ICdDcmVhdGluZyBub2Rlcy4uLic7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlcyA9IG92ZXJwYXNzVG9HcmFwaE5vZGVzKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHN0YXJ0Tm9kZTogR3JhcGhOb2RlO1xyXG4gICAgICAgICAgICAgICAgbGV0IGdvYWxOb2RlOiBHcmFwaE5vZGU7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2VhcmNoRnVuY3Rpb246IFNlYXJjaEZ1bmN0aW9uO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdENpcmNsZVN0eWxlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJhZGl1czogNixcclxuICAgICAgICAgICAgICAgICAgICBzdHJva2U6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAwLjdcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlSWRUb0NpcmNsZSA9IG5ldyBNYXA8bnVtYmVyLCBMLkNpcmNsZT4obm9kZXMubWFwKG5vZGUgPT4gW1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgTC5jaXJjbGUobm9kZSwgZGVmYXVsdENpcmNsZVN0eWxlKS5iaW5kUG9wdXAoY2lyY2xlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZC50ZXh0Q29udGVudCA9IG5vZGUuaWQudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5hcHBlbmRDaGlsZChpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0TGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRMaW5rLmhyZWYgPSAnIyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0TGluay50ZXh0Q29udGVudCA9ICdTZXQgYXMgc3RhcnQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydExpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZSA9PT0gZ29hbE5vZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnROb2RlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobm9kZUlkVG9DaXJjbGUuZ2V0KHN0YXJ0Tm9kZS5pZCkgYXMgTC5DaXJjbGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRTdHlsZShkZWZhdWx0Q2lyY2xlU3R5bGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnROb2RlID0gbm9kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Tm9kZUlkRWxlbS50ZXh0Q29udGVudCA9IHN0YXJ0Tm9kZS5pZC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tTZWFyY2hCdXR0b24oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNpcmNsZS5jbG9zZVBvcHVwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2lyY2xlIGFzIEwuQ2lyY2xlKS5zZXRTdHlsZShPYmplY3QuYXNzaWduKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJ3JlZCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGRlZmF1bHRDaXJjbGVTdHlsZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5hcHBlbmRDaGlsZChzdGFydExpbmspO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2JyJykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBnb2FsTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ29hbExpbmsuaHJlZiA9ICcjJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ29hbExpbmsudGV4dENvbnRlbnQgPSAnU2V0IGFzIGdvYWwnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnb2FsTGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlID09PSBzdGFydE5vZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ29hbE5vZGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChub2RlSWRUb0NpcmNsZS5nZXQoZ29hbE5vZGUuaWQpIGFzIEwuQ2lyY2xlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0U3R5bGUoZGVmYXVsdENpcmNsZVN0eWxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvYWxOb2RlID0gbm9kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvYWxOb2RlSWRFbGVtLnRleHRDb250ZW50ID0gZ29hbE5vZGUuaWQudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrU2VhcmNoQnV0dG9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaXJjbGUuY2xvc2VQb3B1cCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNpcmNsZSBhcyBMLkNpcmNsZSkuc2V0U3R5bGUoT2JqZWN0LmFzc2lnbih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICdncmVlbidcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGRlZmF1bHRDaXJjbGVTdHlsZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5hcHBlbmRDaGlsZChnb2FsTGluayk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLmFkZFRvKG1hcClcclxuICAgICAgICAgICAgICAgIF0gYXMgW251bWJlciwgTC5DaXJjbGVdKSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByYWRpb1RvRnVuY3Rpb246IHsgW2lkOiBzdHJpbmddOiBTZWFyY2hGdW5jdGlvbiB9ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICd1bmlmb3JtLWNvc3QtcmFkaW8nOiB1bmlmb3JtQ29zdFNlYXJjaCxcclxuICAgICAgICAgICAgICAgICAgICAnZ3JlZWR5LXJhZGlvJzogZ3JlZWR5U2VhcmNoLFxyXG4gICAgICAgICAgICAgICAgICAgICdhLXN0YXItcmFkaW8nOiBhU3RhclNlYXJjaFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaWQgaW4gcmFkaW9Ub0Z1bmN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignIycgKyBpZCkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaEZ1bmN0aW9uID0gcmFkaW9Ub0Z1bmN0aW9uW2lkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tTZWFyY2hCdXR0b24oKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHF1ZXJ5U3RhdGUudGV4dENvbnRlbnQgPSAnJztcclxuICAgICAgICAgICAgICAgIGhpZGVFbGVtKHF1ZXJ5aW5nU2NyZWVuKTtcclxuICAgICAgICAgICAgICAgIHNob3dFbGVtKGNob29zZVNjcmVlbik7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhub2Rlcy5sZW5ndGggKyAnIG5vZGVzIGNyZWF0ZWQnKTtcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNoZWNrU2VhcmNoQnV0dG9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaEJ1dHRvbi5kaXNhYmxlZCA9ICEoc3RhcnROb2RlICYmIGdvYWxOb2RlICYmIHNlYXJjaEZ1bmN0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNlYXJjaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBoaWRlRWxlbShjaG9vc2VTY3JlZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3dFbGVtKHJlc3VsdHNTY3JlZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaFByb2dyZXNzLmNsYXNzTGlzdC5hZGQoJ21kbC1wcm9ncmVzc19faW5kZXRlcm1pbmF0ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaFN0YXRlLnRleHRDb250ZW50ID0gJ1NlYXJjaGluZy4uLic7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0gc2VhcmNoRnVuY3Rpb24oc3RhcnROb2RlLCBnb2FsTm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoUHJvZ3Jlc3MuY2xhc3NMaXN0LnJlbW92ZSgnbWRsLXByb2dyZXNzX19pbmRldGVybWluYXRlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hTdGF0ZS50ZXh0Q29udGVudCA9ICdQYXRoIG5vdCBmb3VuZCc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoU3RhdGUudGV4dENvbnRlbnQgPSBgUGF0aCBmb3VuZCwgJHtyZXMuZXhwYW5kZWQubGVuZ3RofSBub2RlcyBleHBhbmRlZCwgcGF0aCBpcyAke3Jlcy5wYXRoLmxlbmd0aH0gbm9kZXMgbG9uZ2A7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZXhwYW5kZWQgb2YgcmVzLmV4cGFuZGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobm9kZUlkVG9DaXJjbGUuZ2V0KGV4cGFuZGVkLmlkKSBhcyBMLkNpcmNsZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRTdHlsZShPYmplY3QuYXNzaWduKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJ2RhcmtibHVlJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZGVmYXVsdENpcmNsZVN0eWxlKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBMLnBvbHlsaW5lKHJlcy5wYXRoLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ZWlnaHQ6IDgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJ2RhcmtibHVlJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5hZGRUbyhtYXApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgZnVuY3Rpb24gc2hvd0VsZW0oZWxlbTogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gaGlkZUVsZW0oZWxlbTogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICB9XHJcbn0iXX0=