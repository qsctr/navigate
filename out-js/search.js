'use strict';
var uniformCostSearch = function (start, goal) {
    return bestFirstSearch(start, goal, function (_a) {
        var parentScore = _a.parentScore, distance = _a.distance;
        return parentScore + distance;
    });
};
var greedySearch = function (start, goal) {
    return bestFirstSearch(start, goal, function (_a) {
        var node = _a.node;
        return distanceBetween(node, goal);
    });
};
var aStarSearch = function (start, goal) {
    return bestFirstSearch(start, goal, function (_a) {
        var node = _a.node, parentScore = _a.parentScore, distance = _a.distance;
        return parentScore + distance + distanceBetween(node, goal);
    });
};
function bestFirstSearch(start, goal, scoreFunc) {
    var expanded = [];
    var scores = new Map([[start.id, scoreFunc({
                node: start,
                parentScore: 0,
                distance: 0
            })]]);
    var parents = new Map();
    var fringe = new PriorityQueue({
        comparator: function (a, b) { return scores.get(a.id) - scores.get(b.id); },
        initialValues: [start]
    });
    while (fringe.length > 0) {
        var current = fringe.dequeue();
        var currentScore = scores.get(current.id);
        expanded.push(current);
        for (var _i = 0, _a = current.connections; _i < _a.length; _i++) {
            var _b = _a[_i], distance = _b.distance, child = _b.child;
            if (expanded.includes(child)) {
                continue;
            }
            if (child === goal) {
                expanded.push(child);
                var path = [current, goal];
                var parent_1 = current;
                while (parent_1 !== start) {
                    parent_1 = parents.get(parent_1);
                    path.unshift(parent_1);
                }
                return { expanded: expanded, path: path };
            }
            parents.set(child, current);
            var oldChildScore = scores.get(child.id);
            var newChildScore = scoreFunc({
                node: child,
                parentScore: currentScore,
                distance: distance
            });
            if (oldChildScore === undefined || newChildScore < oldChildScore) {
                scores.set(child.id, newChildScore);
                fringe.queue(child);
            }
        }
    }
    return null;
}
function distanceBetween(a, b) {
    return Math.sqrt(Math.pow(a.lat - b.lat, 2) + Math.pow(a.lng - b.lng, 2));
}
function overpassToGraphNodes(_a) {
    var elements = _a.elements;
    var graphNodes = [];
    var _loop_1 = function(nodes, geometry, junction) {
        var prevGraphNode;
        var firstGraphNode;
        nodes.forEach(function (nodeId, i) {
            var graphNode = graphNodes.find(function (graphNode) { return graphNode.id === nodeId; });
            if (graphNode === undefined) {
                graphNode = {
                    id: nodeId,
                    lat: geometry[i].lat,
                    lng: geometry[i].lon,
                    connections: []
                };
                graphNodes.push(graphNode);
            }
            if (i === 0) {
                firstGraphNode = graphNode;
            }
            else {
                connect(graphNode, prevGraphNode);
            }
            if (i === nodes.length - 1 && junction === 'roundabout') {
                connect(graphNode, firstGraphNode);
            }
            prevGraphNode = graphNode;
        });
    };
    for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {
        var _b = elements_1[_i], nodes = _b.nodes, geometry = _b.geometry, junction = _b.tags.junction;
        _loop_1(nodes, geometry, junction);
    }
    function connect(a, b) {
        var distance = distanceBetween(a, b);
        a.connections.push({ distance: distance, child: b });
        b.connections.push({ distance: distance, child: a });
    }
    return graphNodes;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjLXRzL3NlYXJjaC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7QUEwQ2IsSUFBTSxpQkFBaUIsR0FBbUIsVUFBQyxLQUFLLEVBQUUsSUFBSTtJQUNsRCxPQUFBLGVBQWUsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLFVBQUMsRUFBeUI7WUFBdkIsNEJBQVcsRUFBRSxzQkFBUTtRQUFPLE9BQUEsV0FBVyxHQUFHLFFBQVE7SUFBdEIsQ0FBc0IsQ0FBQztBQUFuRixDQUFtRixDQUFDO0FBRXhGLElBQU0sWUFBWSxHQUFtQixVQUFDLEtBQUssRUFBRSxJQUFJO0lBQzdDLE9BQUEsZUFBZSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsVUFBQyxFQUFRO1lBQU4sY0FBSTtRQUFPLE9BQUEsZUFBZSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7SUFBM0IsQ0FBMkIsQ0FBQztBQUF2RSxDQUF1RSxDQUFDO0FBRTVFLElBQU0sV0FBVyxHQUFtQixVQUFDLEtBQUssRUFBRSxJQUFJO0lBQzVDLE9BQUEsZUFBZSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsVUFBQyxFQUErQjtZQUE3QixjQUFJLEVBQUUsNEJBQVcsRUFBRSxzQkFBUTtRQUN2RCxPQUFBLFdBQVcsR0FBRyxRQUFRLEdBQUcsZUFBZSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7SUFBcEQsQ0FBb0QsQ0FBQztBQUR6RCxDQUN5RCxDQUFDO0FBRTlELHlCQUF5QixLQUFnQixFQUFFLElBQWUsRUFBRSxTQUEwQjtJQUNsRixJQUFNLFFBQVEsR0FBZ0IsRUFBRSxDQUFDO0lBQ2pDLElBQU0sTUFBTSxHQUFHLElBQUksR0FBRyxDQUFZLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLFNBQVMsQ0FBQztnQkFDcEQsSUFBSSxFQUFFLEtBQUs7Z0JBQ1gsV0FBVyxFQUFFLENBQUM7Z0JBQ2QsUUFBUSxF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LHNCQUFRLEVBQVIsSUFBUSxDQUFDO1FBQTFELHVCQUE2QyxFQUFyQyxnQkFBSyxFQUFFLHNCQUFRLEVBQVUsMkJBQVE7O0tBd0I3QztJQUNELGlCQUFpQixDQUFZLEVBQUUsQ0FBWTtRQUN2QyxJQUFNLFFBQVEsR0FBRyxlQUFlLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUUsa0JBQVEsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMzQyxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFLGtCQUFRLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUNELE1BQU0sQ0FBQyxVQUFVLENBQUM7QUFDdEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbnR5cGUgSWQgPSBudW1iZXI7XHJcbnR5cGUgU2NvcmUgPSBudW1iZXI7XHJcbnR5cGUgRGlzdGFuY2UgPSBudW1iZXI7XHJcblxyXG5pbnRlcmZhY2UgR3JhcGhOb2RlIHtcclxuICAgIHJlYWRvbmx5IGxhdDogbnVtYmVyO1xyXG4gICAgcmVhZG9ubHkgbG5nOiBudW1iZXI7XHJcbiAgICByZWFkb25seSBpZDogSWQ7XHJcbiAgICByZWFkb25seSBjb25uZWN0aW9uczogQ29ubmVjdGlvbltdO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgQ29ubmVjdGlvbiB7XHJcbiAgICByZWFkb25seSBkaXN0YW5jZTogRGlzdGFuY2U7XHJcbiAgICByZWFkb25seSBjaGlsZDogR3JhcGhOb2RlO1xyXG59XHJcblxyXG50eXBlIFNjb3JpbmdGdW5jdGlvbiA9IChpbmZvOiB7XHJcbiAgICBub2RlOiBHcmFwaE5vZGU7XHJcbiAgICBwYXJlbnRTY29yZTogU2NvcmU7XHJcbiAgICBkaXN0YW5jZTogRGlzdGFuY2U7XHJcbn0pID0+IFNjb3JlO1xyXG5cclxuaW50ZXJmYWNlIE92ZXJwYXNzSlNPTiB7XHJcbiAgICBlbGVtZW50czoge1xyXG4gICAgICAgIG5vZGVzOiBudW1iZXJbXTtcclxuICAgICAgICBnZW9tZXRyeToge1xyXG4gICAgICAgICAgICBsYXQ6IG51bWJlcjtcclxuICAgICAgICAgICAgbG9uOiBudW1iZXI7XHJcbiAgICAgICAgfVtdO1xyXG4gICAgICAgIHRhZ3M6IHtcclxuICAgICAgICAgICAganVuY3Rpb246IHN0cmluZ1xyXG4gICAgICAgIH07XHJcbiAgICB9W107XHJcbn1cclxuXHJcbnR5cGUgU2VhcmNoRnVuY3Rpb24gPSAoc3RhcnQ6IEdyYXBoTm9kZSwgZ29hbDogR3JhcGhOb2RlKSA9PiB7XHJcbiAgICBleHBhbmRlZDogR3JhcGhOb2RlW10sXHJcbiAgICBwYXRoOiBHcmFwaE5vZGVbXVxyXG59IHwgbnVsbDtcclxuXHJcbmNvbnN0IHVuaWZvcm1Db3N0U2VhcmNoOiBTZWFyY2hGdW5jdGlvbiA9IChzdGFydCwgZ29hbCkgPT5cclxuICAgIGJlc3RGaXJzdFNlYXJjaChzdGFydCwgZ29hbCwgKHsgcGFyZW50U2NvcmUsIGRpc3RhbmNlIH0pID0+IHBhcmVudFNjb3JlICsgZGlzdGFuY2UpO1xyXG5cclxuY29uc3QgZ3JlZWR5U2VhcmNoOiBTZWFyY2hGdW5jdGlvbiA9IChzdGFydCwgZ29hbCkgPT5cclxuICAgIGJlc3RGaXJzdFNlYXJjaChzdGFydCwgZ29hbCwgKHsgbm9kZSB9KSA9PiBkaXN0YW5jZUJldHdlZW4obm9kZSwgZ29hbCkpO1xyXG5cclxuY29uc3QgYVN0YXJTZWFyY2g6IFNlYXJjaEZ1bmN0aW9uID0gKHN0YXJ0LCBnb2FsKSA9PlxyXG4gICAgYmVzdEZpcnN0U2VhcmNoKHN0YXJ0LCBnb2FsLCAoeyBub2RlLCBwYXJlbnRTY29yZSwgZGlzdGFuY2UgfSkgPT5cclxuICAgICAgICBwYXJlbnRTY29yZSArIGRpc3RhbmNlICsgZGlzdGFuY2VCZXR3ZWVuKG5vZGUsIGdvYWwpKTtcclxuXHJcbmZ1bmN0aW9uIGJlc3RGaXJzdFNlYXJjaChzdGFydDogR3JhcGhOb2RlLCBnb2FsOiBHcmFwaE5vZGUsIHNjb3JlRnVuYzogU2NvcmluZ0Z1bmN0aW9uKSB7XHJcbiAgICBjb25zdCBleHBhbmRlZDogR3JhcGhOb2RlW10gPSBbXTtcclxuICAgIGNvbnN0IHNjb3JlcyA9IG5ldyBNYXA8SWQsIFNjb3JlPihbW3N0YXJ0LmlkLCBzY29yZUZ1bmMoe1xyXG4gICAgICAgIG5vZGU6IHN0YXJ0LFxyXG4gICAgICAgIHBhcmVudFNjb3JlOiAwLFxyXG4gICAgICAgIGRpc3RhbmNlOiAwXHJcbiAgICB9KV1dKTtcclxuICAgIGNvbnN0IHBhcmVudHMgPSBuZXcgTWFwPEdyYXBoTm9kZSwgR3JhcGhOb2RlPigpO1xyXG4gICAgY29uc3QgZnJpbmdlID0gbmV3IFByaW9yaXR5UXVldWU8R3JhcGhOb2RlPih7XHJcbiAgICAgICAgY29tcGFyYXRvcjogKGE6IEdyYXBoTm9kZSwgYjogR3JhcGhOb2RlKSA9PiBzY29yZXMuZ2V0KGEuaWQpIC0gc2NvcmVzLmdldChiLmlkKSxcclxuICAgICAgICBpbml0aWFsVmFsdWVzOiBbc3RhcnRdXHJcbiAgICB9KTtcclxuICAgIHdoaWxlIChmcmluZ2UubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSBmcmluZ2UuZGVxdWV1ZSgpO1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRTY29yZSA9IHNjb3Jlcy5nZXQoY3VycmVudC5pZCkgYXMgU2NvcmU7XHJcbiAgICAgICAgZXhwYW5kZWQucHVzaChjdXJyZW50KTtcclxuICAgICAgICBmb3IgKGNvbnN0IHsgZGlzdGFuY2UsIGNoaWxkIH0gb2YgY3VycmVudC5jb25uZWN0aW9ucykge1xyXG4gICAgICAgICAgICBpZiAoZXhwYW5kZWQuaW5jbHVkZXMoY2hpbGQpKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY2hpbGQgPT09IGdvYWwpIHtcclxuICAgICAgICAgICAgICAgIGV4cGFuZGVkLnB1c2goY2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGF0aCA9IFtjdXJyZW50LCBnb2FsXTtcclxuICAgICAgICAgICAgICAgIGxldCBwYXJlbnQgPSBjdXJyZW50O1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKHBhcmVudCAhPT0gc3RhcnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnRzLmdldChwYXJlbnQpIGFzIEdyYXBoTm9kZTtcclxuICAgICAgICAgICAgICAgICAgICBwYXRoLnVuc2hpZnQocGFyZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB7IGV4cGFuZGVkLCBwYXRoIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcGFyZW50cy5zZXQoY2hpbGQsIGN1cnJlbnQpO1xyXG4gICAgICAgICAgICBjb25zdCBvbGRDaGlsZFNjb3JlID0gc2NvcmVzLmdldChjaGlsZC5pZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld0NoaWxkU2NvcmUgPSBzY29yZUZ1bmMoe1xyXG4gICAgICAgICAgICAgICAgbm9kZTogY2hpbGQsXHJcbiAgICAgICAgICAgICAgICBwYXJlbnRTY29yZTogY3VycmVudFNjb3JlLFxyXG4gICAgICAgICAgICAgICAgZGlzdGFuY2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmIChvbGRDaGlsZFNjb3JlID09PSB1bmRlZmluZWQgfHwgbmV3Q2hpbGRTY29yZSA8IG9sZENoaWxkU2NvcmUpIHtcclxuICAgICAgICAgICAgICAgIHNjb3Jlcy5zZXQoY2hpbGQuaWQsIG5ld0NoaWxkU2NvcmUpO1xyXG4gICAgICAgICAgICAgICAgZnJpbmdlLnF1ZXVlKGNoaWxkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG59XHJcblxyXG5mdW5jdGlvbiBkaXN0YW5jZUJldHdlZW4oYTogR3JhcGhOb2RlLCBiOiBHcmFwaE5vZGUpIHtcclxuICAgIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3coYS5sYXQgLSBiLmxhdCwgMikgKyBNYXRoLnBvdyhhLmxuZyAtIGIubG5nLCAyKSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG92ZXJwYXNzVG9HcmFwaE5vZGVzKHsgZWxlbWVudHMgfTogT3ZlcnBhc3NKU09OKSB7XHJcbiAgICBjb25zdCBncmFwaE5vZGVzOiBHcmFwaE5vZGVbXSA9IFtdO1xyXG4gICAgZm9yIChjb25zdCB7IG5vZGVzLCBnZW9tZXRyeSwgdGFnczogeyBqdW5jdGlvbiB9IH0gb2YgZWxlbWVudHMpIHtcclxuICAgICAgICBsZXQgcHJldkdyYXBoTm9kZTogR3JhcGhOb2RlO1xyXG4gICAgICAgIGxldCBmaXJzdEdyYXBoTm9kZTogR3JhcGhOb2RlO1xyXG4gICAgICAgIG5vZGVzLmZvckVhY2goKG5vZGVJZCwgaSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgZ3JhcGhOb2RlID0gZ3JhcGhOb2Rlcy5maW5kKGdyYXBoTm9kZSA9PiBncmFwaE5vZGUuaWQgPT09IG5vZGVJZCk7XHJcbiAgICAgICAgICAgIGlmIChncmFwaE5vZGUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgZ3JhcGhOb2RlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBub2RlSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgbGF0OiBnZW9tZXRyeVtpXS5sYXQsXHJcbiAgICAgICAgICAgICAgICAgICAgbG5nOiBnZW9tZXRyeVtpXS5sb24sXHJcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbnM6IFtdIGFzIENvbm5lY3Rpb25bXVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGdyYXBoTm9kZXMucHVzaChncmFwaE5vZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBmaXJzdEdyYXBoTm9kZSA9IGdyYXBoTm9kZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbm5lY3QoZ3JhcGhOb2RlLCBwcmV2R3JhcGhOb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaSA9PT0gbm9kZXMubGVuZ3RoIC0gMSAmJiBqdW5jdGlvbiA9PT0gJ3JvdW5kYWJvdXQnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25uZWN0KGdyYXBoTm9kZSwgZmlyc3RHcmFwaE5vZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHByZXZHcmFwaE5vZGUgPSBncmFwaE5vZGU7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBjb25uZWN0KGE6IEdyYXBoTm9kZSwgYjogR3JhcGhOb2RlKSB7XHJcbiAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBkaXN0YW5jZUJldHdlZW4oYSwgYik7XHJcbiAgICAgICAgYS5jb25uZWN0aW9ucy5wdXNoKHsgZGlzdGFuY2UsIGNoaWxkOiBiIH0pO1xyXG4gICAgICAgIGIuY29ubmVjdGlvbnMucHVzaCh7IGRpc3RhbmNlLCBjaGlsZDogYSB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBncmFwaE5vZGVzO1xyXG59Il19